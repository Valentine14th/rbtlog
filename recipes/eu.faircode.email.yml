---
repository: https://github.com/M66B/FairEmail.git
updates: releases
notes:
  - 'NB: NonFreeComp'
  - 'FIXME: embedded build ID (use readelf --notes to extract from .so)'
  - 'FIXME: JARs'
versions:
  - tag: '1.2162'
    apks:
      - apk_pattern: FairEmail-.*-github-release\.apk
        apk_url: https://github.com/M66B/FairEmail/releases/download/1.2162/FairEmail-v1.2162a-github-release.apk
        build:
          - sed -r '/release \{/,/}/ { /signingConfig/d }' -i app/build.gradle
          - printf '\n%s\n  %s' 'if(ANDROID_ABI STREQUAL "arm64-v8a")'        'target_link_options(fairemail PRIVATE "LINKER:--build-id=0xc72e359a3ab7fbea4b6c83418c05047c3ae0e037")' >> app/CMakeLists.txt
          - printf '\n%s\n  %s' 'elseif(ANDROID_ABI STREQUAL "armeabi-v7a")'  'target_link_options(fairemail PRIVATE "LINKER:--build-id=0x9f0e69532167041e3380d050a129656b65056795")' >> app/CMakeLists.txt
          - printf '\n%s\n  %s' 'elseif(ANDROID_ABI STREQUAL "x86")'          'target_link_options(fairemail PRIVATE "LINKER:--build-id=0xb7c8b1944d9a06956339273878be29ca14847ca1")' >> app/CMakeLists.txt
          - printf '\n%s\n  %s' 'else()'                                      'target_link_options(fairemail PRIVATE "LINKER:--build-id=0x08d8c751cd33b45876eccd2353fc6a926abbb04d")' >> app/CMakeLists.txt
          - printf '\n%s\n'     'endif()'                                                                                                                                             >> app/CMakeLists.txt
          - ./gradlew assembleGithubRelease
          - mv app/build/outputs/apk/github/release/FairEmail-*-github-release-unsigned.apk /outputs/unsigned.apk
        build_home_dir: /build
        build_repo_dir: /build/repo
        build_user: build
        provisioning:
          android_home: /opt/sdk
          build_tools:
          cmake:
          cmdline_tools:
            version: '12.0'
            url: https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip
            sha256: 2d2d50857e4eb553af5a6dc3ad507a17adf43d115264b1afc116f95c92e5e258
          extra_packages: []
          image: debian:bookworm-slim
          jdk: openjdk-17-jdk-headless
          ndk:
          platform:
          platform_tools:
          tools:
          verify_gradle_wrapper: true
